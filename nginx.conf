server {
    listen       80;
    server_name  machbank.com www.machbank.com;
    return 301 https://www.machbank.com$request_uri;
}

server {

     listen 443 ssl http2;
     server_name  machbank.com www.machbank.com;
     root /usr/share/nginx/html/machbank.com;
     index  index.php index.html index.htm;
     access_log /var/log/nginx/machha-access.log;
     error_log /var/log/nginx/machha-error.log;
     #ssl_certificate /etc/nginx/ssl/STAR_machbank_com.crt;
     #ssl_certificate_key /etc/nginx/ssl/mbl.key;
     ssl_certificate /etc/nginx/mach_cert/wildcard_machbank.com.crt;
     ssl_certificate_key /etc/nginx/mach_cert/machbank.com.key;

#redirect non www to www with HTTPS
    if ($host = 'machbank.com') {
        return 301 https://www.machbank.com$request_uri;
         }

    #header security
     add_header X-Frame-Options "SAMEORIGIN" always;
     add_header Strict-Transport-Security "max-age=31536000;     includeSubdomains" always;
     add_header X-XSS-Protection "1; mode=block" always;
     add_header X-Content-Type-Options "nosniff" always;
     add_header Referrer-Policy "no-referrer-when-downgrade";
     add_header X-Permitted-Cross-Domain-Policies master-only;
     add_header Feature-Policy "camera 'none'; speaker 'none';";
     add_header Access-Control-Allow-Origin '*' always;
     add_header 'Access-Control-Allow-Headers' '*';
     add_header 'Access-Control-Allow-Methods' 'GET, POST, OPTIONS';

     add_header Content-Security-Policy "default-src 'self' *.machbank.com https://machbank.com https://www.machbank.com  *.cloudflare.com *.github.io *.googleapis.com *.jquery.com *.gstatic.com *.youtube.com *.facebook.com; script-src 'self' *.machbank.com https://machbank.com https://www.machbank.com  *.jquery.com  'unsafe-eval' 'unsafe-inline' *.cloudflare.com *.github.io *.googleapis.com  *.gstatic.com *.googletagmanager.com *.facebook.net *.google-analytics.com *.datatables.net; connect-src 'self' https://machbank.com https://www.machbank.com  *.jquery.com https://www.facebook.com https://web.facebook.com *.google-analytics.com *.googleapis.com;img-src 'self' *.machbank.com https://machbank.com https://www.machbank.com 'unsafe-inline' data: *.gstatic.com *.googleapis.com *.ggpht *.youtube.com *.ytimg.com *.google-analytics.com https://machbank.com/ https://www.machbank.com *.machbank.com  *.google.com; style-src 'self' 'unsafe-inline' https://machbank.com/ https://www.machbank.com 'unsafe-eval' *.cloudflare.com *.github.io *.gstatic.com *.googleapis.com; frame-src 'self' *.machbank.com https://lalitmoney.net https://www.machbank.com  https://machbank.com https://web.facebook.com/ https://www.facebook.com; style-src-elem  'self' https://www.machbank.com  https://machbank.com/ *.machbank.com https://cdnjs.cloudflare.com/ https://fonts.googleapis.com/  'unsafe-inline' 'unsafe-eval'; frame-ancestors 'self' smartchautari.machbank.com https://lalitmoney.net;" always;


##strong cipher security
        ssl_session_cache shared:le_nginx_SSL:10m;
        ssl_session_timeout 1440m;
        ssl_session_tickets off;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;
        ssl_ciphers "ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384";


##BAD-bot-attack-security
        if ($bad_bot) { return 404; }

###krishna nginx status active connections
location /nginx_status/ {
        stub_status on;
 }

 location / {
        try_files $uri $uri/ /index.php?$query_string;
#     limit_req zone=mylimit burst=300 nodelay;
  }
 location /demat {
        try_files $uri $uri/ /demat/index.php?$query_string;
#     limit_req zone=mylimit burst=300 nodelay;
  }

 location /online-account {
        try_files $uri $uri/ /online-account/index.php?$query_string;
#     limit_req zone=mylimit burst=300 nodelay;
  }

location /apply-loan {
        try_files $uri $uri/ /apply-loan/index.php?$query_string;
#     limit_req zone=mylimit burst=300 nodelay;
  }

  ##for location /staff
# location /staff/ {
# try_files $uri $uri/ /staff/index.php?$query_string;
#  }


location /staff/ {
       alias /var/www/html/staff/;
        try_files $uri $uri/ @staff;

        }

   location @staff {
        rewrite /staff/(.*)$ /staff/index.php?/$1 last;
    }


      location ~* \.php$ {
    fastcgi_index   index.php;
    fastcgi_pass   php;
    include         fastcgi_params;
    fastcgi_param   SCRIPT_FILENAME    $document_root$fastcgi_script_name;
    fastcgi_param   SCRIPT_NAME        $fastcgi_script_name;
}

location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
        expires 3m;
        add_header Cache-Control "public, no-transform";
    }

 location ~* /.+\.(markdown|md|twig|yaml|yml|ini)$ {
        deny all;
        access_log off;
        log_not_found off;
    }

    # Deny all grunt, package files
    location ~* (Gruntfile|package)\.(js|json|jsonc)$ {
        deny all;
        access_log off;
        log_not_found off;
    }

    # Deny all composer files
    location ~* composer\. {
        deny all;
        access_log off;
        log_not_found off;
    }

  location ~ /\.ht {
       deny  all;
   }

}

